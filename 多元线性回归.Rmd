---
title: "多元线性回归与相关"
author: "shydow"
date: "2018年12月19日"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**目标**  

    1、多元线性回归模型矩阵形式
    2、模型，参数估计过程及参数解释，以及标准化参数估计
    3、共线性诊断问题
    4、理解复相关系数和偏相关系数
    5、R程序：多元线性回归模型，偏相关计算
    
###多元线性回归与相关的基础理论

**借助于一个数学模型来解释总体中若干个自变量与一个因变量之间的线性关系，并评估用这一个数学模型模拟相关事物变化规律的准确性。具体地说，多元线性回归可以从统计意义上确定在消除了其他自变量影响之后，每一个自变量的变化是否引起因变量的变化，并且估计其它自变量不变的情况下，每一个自变量对因变量的数值影响大小**  

    模型：
    
    Y=a0+a1X1+a2X2+a3X3.....+anXn+μ   a0：常数项  a..n:系数项  μ：误差项
    
    总体的回归方程： E(Y)=Xa
    
    偏回归系数：在研究一个自变量对因变量的影响时，需要其他自变量保持不变，因此多元线性回归模型中的回归系数为偏回归系数，反映了其他变量不变时，一个自变量对因变量的均值的影响。
    
    残差：样本估计值与实际观测值之间的偏差
    
    多元线性回归的假设条件：
    1、因变量Y服从正态分布的连续型随机变量
    2、自变量是固定变量
    3、自变量之间不存在多重共线性
    4、自变量与残差独立
    5、残差是随机变量，均值为0，方差为常数
    6、残差之间相互独立
    7、残差服从正态分布
    
###多元线性模型的参数估计

**  回归参数的简单求解：   β=(XX')-1X'Y    X'转置矩阵 -1矩阵的逆  Y因变量矩阵 **

    显著性检验：
    1、拟合度检验
    --总离差平方和分解
    --TSS=ESS+RSS  
    TSS：总离差平方和，（实际值-平均值）的平方和
    ESS:回归平方和，（预测值-平均值）的平方和
    RSS：残差平方和，（真实值-预测值）的平方和
    
    --样本决定系数
    R^2=ESS/TSS=1-RSS/TSS
    
    在这里有一个重点：
    在多元线性回归中，使用R方时，容易受模型解释变量的数目的影响，当模型中增加一个变量时，TSS不会发生改变，但ESS将会增加，就将会使得R方增大，这是不合适的，需要对R方进行处理，就引出了调整后的R方。
    
    2、模型显著性检验
    --F检验：   F=(ESS/K)/(RSS/N-K-1)  K是ESS的自由度   RSS的自由度为 n-1-K  TSS自由度n-1
    
    3、参数显著性检验
    
    
###回归变量的选择与逐步回归法

    选择最优的变量筛选法：
    1、向前引入法
    --从常数项开始引入，将自变量逐个引入回归方程中，从与因变量最密切的自变量开始选择，当达到规定的显著性检查时，则引入过程结束，所得的即是最优方程。
    缺点：各变量可能存在相互关系，肯能会使得后面选入的变量变得不重要，包含对y影响不大的自变量
    
    2、向后剔除法
    --首相将所有的自变量引入，然后剔除对因变量影响不大的自变量
    缺点：可能漏掉相对重要的变量
    
    3、逐步回归法
    实施：对每一步引入的变量计算偏回归平方和（贡献），确定F值----逐步计算----其他计算
    
    
###多重共线性

    1、直观的判断方法
    --在自变量相关系数矩阵中，某些变量的相关系数值比较大
    --回归系数的符号与专业知识或一般经验相反
    --增加一个变量或者删除一个变量，回顾系数的估计值会发生很大的变化
    
    2、方差扩大因子法
    
    3、特征根判断方法
    
    --处理方法：
    
    1、增加样本容量
    2、剔除一些不重要的解释变量
    3、不相关的系数法
    4、主成分法
    
    
###复相关系数与偏相关系数

    复相关系数：测定因变量y与一组自变量x1，x2之间相关程度的指标
    偏相关系数：当其他变量固定不变时，或者说消除其他变量的影响后，两个变量之间线性关联的强度
    
    
###案例

    零售店将其连续18个月的库存占用资金情况、广告投入费用、员工薪酬、销售额等方面数据做了一个汇总，根据这些数据找到销售额与其他3个变量之间的关系，以便进行销售额预测并未未来的预算工作提供参考。
    
```{r}
library(MASS)
example10_2<-read.csv('F:\\课件\\资源\\《R语言统计分析与应用》配套程序\\第十章\\example10_2.csv',header=TRUE)
attach(example10_2)

plot(Y,type = 'b',col='blue',main = '趋势图',xlab='month',ylab='销量')

fit1=lm(Y~X1+X2+X3)
step(fit1,direction = 'both')   

#由逐步回归确定最优模型为lm(Y~X1+X2)
fit=lm(Y~X1+X2)
anova(fit)
summary(fit)

fitted(fit)    #预测值
residuals(fit)    #残差

detach(example10_2)

```
    


